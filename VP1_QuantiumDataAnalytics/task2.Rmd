---
title: "Task 2 - Retail Strategy and Analytics - Quantium Virtual Internship"
author: "Shrishti Vaish"
date: "27/07/2020"
output: pdf_document:
  df_print: default
  highlight: tango
  keep_tex: yes
  latex_engine: xelatex
header-includes:
 \usepackage{fvextra}

\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Load required libraries and datasets
```{r message=FALSE, warning=FALSE, results='hide'}
library(data.table)
library(ggplot2)
library(tidyr)
```


##Load the dataset
```{r}
filePath <-""
data <- fread(paste0(filePath,"QVI_data.csv"))
```


#### Set themes for plots
```{r}
theme_set(theme_bw())
theme_update(plot.title = element_text(hjust = 0.5))

```


## Select Control Stores

The client has selected store numbers 77, 86 and 88 as trial stores and want control stores to be established stores that are operational for the entire observation period.
We would want to match trial stores to control stores that are similar to the trial store prior to the trial period of Feb 2019 in terms of :

- Monthly overall sales revenue
- Monthly number of customers
- Monthly number of transactions per customer

Let's first create the metrics of interest and filter to stores that are present throughout the pre-trial period.

```{r message=FALSE, warning=FALSE, results='hide'}

#### Calculate these measures over time for each store
#### Add a new month ID column in the data with the format yyyymm.
library(lubridate)

monthYear <- paste(year(data$DATE),month(data$DATE), sep = "-")
data[, YEARMONTH := monthYear]


#### Next, we define the measure calculations to use during the analysis.  For each store and month calculate total sales, number of customers,transactions per customer, chips per customer and the average price per unit.

measureOverTime <- data %>% group_by(YEARMONTH) %>% summarise(totSales = sum(TOT_SALES), nCustomers = uniqueN(LYLTY_CARD_NBR), nTxnPerCust = uniqueN(TXN_ID),nChipsPerTxn = sum(PROD_QTY), avgPricePerUnit = sum(TOT_SALES)/sum(PROD_QTY))
#, nTxnPerCust = uniqueN(TXN_ID)/uniqueN(YEARMONTH), nChipsPerTxn = PROD_QTY/uniqueN(TXN_ID), avgPricePerUnit = sum(TOT_SALES)/sum(PROD_QTY) )
```
















